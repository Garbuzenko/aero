# üìä DataLens ‚Äî –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Yandex DataLens

## üìñ –û–ø–∏—Å–∞–Ω–∏–µ

–ü–∞–ø–∫–∞ **Datalens** —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å **Yandex DataLens** ‚Äî —Å–µ—Ä–≤–∏—Å–æ–º –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –í–∫–ª—é—á–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–∞—à–±–æ—Ä–¥–æ–≤, —á–∞—Ä—Ç–æ–≤ –∏ –º–µ—Ö–∞–Ω–∏–∑–º –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏—è —Å JWT-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
Datalens/
‚îú‚îÄ‚îÄ lct.json         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–∞—à–±–æ—Ä–¥–æ–≤ –∏ —á–∞—Ä—Ç–æ–≤ DataLens
‚îú‚îÄ‚îÄ README.md        # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
‚îî‚îÄ‚îÄ ../datalens.py   # –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä JWT —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏—è
```

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ú–æ–¥—É–ª—å —Ä–µ—à–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–¥–∞—á–∏:

- ‚úÖ **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** —á–µ—Ä–µ–∑ Yandex DataLens
- ‚úÖ **–í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–æ–≤** –Ω–∞ —Å–∞–π—Ç aerometr.ru
- ‚úÖ **JWT-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —á–∞—Ä—Ç—ã** –∏ –≥—Ä–∞—Ñ–∏–∫–∏
- ‚úÖ **–†–µ–∞–ª-—Ç–∞–π–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **–≠–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** –¥–∞—à–±–æ—Ä–¥–æ–≤

---

## üóÇÔ∏è –§–∞–π–ª—ã

### 1. lct.json

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–∞—à–±–æ—Ä–¥–æ–≤ DataLens –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ

**–°–æ–¥–µ—Ä–∂–∏—Ç:**
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –î–∞—Ç–∞—Å–µ—Ç—ã (datasets)
- –ß–∞—Ä—Ç—ã (charts)
- –î–∞—à–±–æ—Ä–¥—ã (dashboards)
- –§–∏–ª—å—Ç—Ä—ã –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- –°–≤—è–∑–∏ –º–µ–∂–¥—É –æ–±—ä–µ–∫—Ç–∞–º–∏

**–†–∞–∑–º–µ—Ä:** ~200MB (–≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏)

**–§–æ—Ä–º–∞—Ç:**
```json
{
  "dashboards": [...],
  "datasets": [...],
  "charts": [...],
  "connections": [...],
  "widgets": [...]
}
```

### 2. ../datalens.py

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä JWT —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏—è –¥–∞—à–±–æ—Ä–¥–æ–≤

**–ö–æ–¥:**
```python
import time
import jwt
from settings import private_key

now = int(time.time())
payload = {
    'embedId': "8e0tatm9jpjit",
    'dlEmbedService': "YC_DATALENS_EMBEDDING_SERVICE_MARK",
    'iat': now,
    'exp': now + 3600,  # –¢–æ–∫–µ–Ω –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω 1 —á–∞—Å
    "params": {}
}

encoded_token = jwt.encode(payload, private_key, algorithm='PS256')
print(encoded_token)
```

---

## üîê JWT-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

### –ú–µ—Ö–∞–Ω–∏–∑–º —Ä–∞–±–æ—Ç—ã

1. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
2. **–ü–µ—Ä–µ–¥–∞—á–∞ —Ç–æ–∫–µ–Ω–∞** –≤ iframe
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏** DataLens
4. **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–∞** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ JWT payload

```json
{
  "embedId": "8e0tatm9jpjit",
  "dlEmbedService": "YC_DATALENS_EMBEDDING_SERVICE_MARK",
  "iat": 1697712345,
  "exp": 1697715945,
  "params": {
    "region_id": "77",
    "date_from": "2024-01-01",
    "date_to": "2025-12-31"
  }
}
```

**–ü–æ–ª—è:**
- `embedId` ‚Äî ID –≤—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–≥–æ –¥–∞—à–±–æ—Ä–¥–∞
- `dlEmbedService` ‚Äî –º–µ—Ç–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ DataLens
- `iat` (issued at) ‚Äî –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
- `exp` (expiration) ‚Äî –≤—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è (–æ–±—ã—á–Ω–æ +1 —á–∞—Å)
- `params` ‚Äî –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

### –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–¥–ø–∏—Å–∏

**PS256 (RSA-PSS with SHA-256)**
- –¢—Ä–µ–±—É–µ—Ç—Å—è RSA –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á (PEM —Ñ–æ—Ä–º–∞—Ç)
- –ö–ª—é—á —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `settings.py` (–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `private_key`)

---

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–∞

#### –ß–µ—Ä–µ–∑ Python —Å–∫—Ä–∏–ø—Ç

```bash
cd /path/to/aerometr
python datalens.py
```

**–í—ã–≤–æ–¥:**
```
eyJhbGciOiJQUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWJlZElkIjoiOGUwdGF0bTlq...
```

#### –ß–µ—Ä–µ–∑ API endpoint

```python
# app.py
@app.route('/generate_datalens_token', methods=['GET'])
def generate_datalens_token():
    import time
    now = int(time.time())
    payload = {
        'embedId': "8e0tatm9jpjit",
        'dlEmbedService': "YC_DATALENS_EMBEDDING_SERVICE_MARK",
        'iat': now,
        'exp': now + 3600,
        "params": {}
    }
    
    encoded_token = jwt.encode(payload, private_key, algorithm='PS256')
    
    return jsonify({
        "token": encoded_token,
        "expires_in": 3600,
        "generated_at": time.strftime('%Y-%m-%d %H:%M:%S')
    })
```

**–ó–∞–ø—Ä–æ—Å:**
```bash
curl http://localhost:5000/generate_datalens_token
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "token": "eyJhbGciOiJQUzI1NiIsInR5cCI6IkpXVCJ9...",
  "expires_in": 3600,
  "generated_at": "2025-10-19 12:30:45"
}
```

---

## üñ•Ô∏è –í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–∞

### HTML –∫–æ–¥

```html
<!DOCTYPE html>
<html>
<head>
    <title>–ê—ç—Ä–æ–º–µ—Ç—Ä - –î–∞—à–±–æ—Ä–¥</title>
</head>
<body>
    <h1>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª–µ—Ç–æ–≤ –ë–ü–õ–ê</h1>
    
    <!-- –í—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π –¥–∞—à–±–æ—Ä–¥ DataLens -->
    <iframe 
        src="https://datalens.yandex.ru/embed/8e0tatm9jpjit?_embedded=1&_theme=light&_lang=ru&_no_controls=1"
        width="100%" 
        height="800px" 
        frameborder="0"
        id="datalens-iframe">
    </iframe>
    
    <script>
        // –ü–æ–ª—É—á–µ–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞
        async function loadDashboard() {
            const response = await fetch('/generate_datalens_token');
            const data = await response.json();
            
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –≤ URL iframe
            const iframe = document.getElementById('datalens-iframe');
            const baseUrl = iframe.src.split('?')[0];
            iframe.src = `${baseUrl}?_token=${data.token}&_embedded=1&_theme=light&_lang=ru`;
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        loadDashboard();
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∫–∞–∂–¥—ã–µ 50 –º–∏–Ω—É—Ç
        setInterval(loadDashboard, 50 * 60 * 1000);
    </script>
</body>
</html>
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏—è

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ó–Ω–∞—á–µ–Ω–∏—è |
|----------|----------|----------|
| `_embedded=1` | –†–µ–∂–∏–º –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏—è | 0, 1 |
| `_theme` | –¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è | light, dark |
| `_lang` | –Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ | ru, en |
| `_no_controls=1` | –°–∫—Ä—ã—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è | 0, 1 |
| `_token` | JWT —Ç–æ–∫–µ–Ω –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ | —Å—Ç—Ä–æ–∫–∞ |

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞—à–±–æ—Ä–¥–æ–≤

### –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥—ã

#### 1. –ì–ª–∞–≤–Ω—ã–π –¥–∞—à–±–æ—Ä–¥
- **–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** –ø–æ –†–æ—Å—Å–∏–∏
- **–ö–∞—Ä—Ç–∞ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏** –ø–æ–ª–µ—Ç–æ–≤
- **–¢–æ–ø-10 —Ä–µ–≥–∏–æ–Ω–æ–≤** –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –ø–æ–ª–µ—Ç–æ–≤
- **–î–∏–Ω–∞–º–∏–∫–∞ –ø–æ –º–µ—Å—è—Ü–∞–º**
- **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫**

#### 2. –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- **–í—ã–±–æ—Ä —Ä–µ–≥–∏–æ–Ω–∞** (—Ñ–∏–ª—å—Ç—Ä)
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ä–µ–≥–∏–æ–Ω—É**
- **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ —Ä–µ–≥–∏–æ–Ω–∞–º–∏**
- **–¢—Ä–µ–Ω–¥—ã –∏ –ø—Ä–æ–≥–Ω–æ–∑—ã**

#### 3. –ü–ª–æ—â–∞–¥–∫–∏ –ë–ü–õ–ê
- **–ö–∞—Ä—Ç–∞ 290 –ø–ª–æ—â–∞–¥–æ–∫**
- **–†–µ–π—Ç–∏–Ω–≥ –ø–ª–æ—â–∞–¥–æ–∫**
- **–¢—Ä–∞—Ñ–∏–∫ –≤ –∑–æ–Ω–∞—Ö**
- **–ó–∞–ø—Ä–µ—Ç–Ω—ã–µ –∑–æ–Ω—ã**

#### 4. Real-time –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- **–ê–∫—Ç–∏–≤–Ω—ã–µ —Å–∞–º–æ–ª–µ—Ç—ã** (–ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å)
- **–ö–∞—Ä—Ç–∞ –ø–æ–ª–µ—Ç–æ–≤** –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- **–°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏** —Ñ–∞–π–ª–æ–≤
- **–°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏**

---

## üé® –¢–∏–ø—ã —á–∞—Ä—Ç–æ–≤

### –ö–∞—Ä—Ç—ã

```
- –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ –ø–æ–ª–µ—Ç–æ–≤
- –¢–æ—á–µ—á–Ω–∞—è –∫–∞—Ä—Ç–∞ —Å–∞–º–æ–ª–µ—Ç–æ–≤
- –ü–æ–ª–∏–≥–æ–Ω–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ —Ä–µ–≥–∏–æ–Ω–æ–≤
- –ì–µ–∫—Å–∞–≥–æ–Ω–∞–ª—å–Ω–∞—è —Å–µ—Ç–∫–∞ H3
```

### –ì—Ä–∞—Ñ–∏–∫–∏

```
- –õ–∏–Ω–µ–π–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ –¥–∏–Ω–∞–º–∏–∫–∏
- –°—Ç–æ–ª–±—á–∞—Ç—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
- –ö—Ä—É–≥–æ–≤—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
- –í–æ—Ä–æ–Ω–∫–∏ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
```

### –¢–∞–±–ª–∏—Ü—ã

```
- –°–≤–æ–¥–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
- –¢–æ–ø-N —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- Drill-down —Ç–∞–±–ª–∏—Ü—ã
```

---

## üì• –≠–∫—Å–ø–æ—Ä—Ç/–ò–º–ø–æ—Ä—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –≠–∫—Å–ø–æ—Ä—Ç –¥–∞—à–±–æ—Ä–¥–∞

**–ß–µ—Ä–µ–∑ UI DataLens:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ –¥–∞—à–±–æ—Ä–¥ –≤ DataLens
2. –ú–µ–Ω—é ‚Üí –≠–∫—Å–ø–æ—Ä—Ç
3. –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç JSON
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª

**–ß–µ—Ä–µ–∑ API:**
```bash
curl -X GET \
  -H "Authorization: Bearer <YC_TOKEN>" \
  "https://datalens.yandex.ru/api/v1/dashboards/<DASHBOARD_ID>/export"
```

### –ò–º–ø–æ—Ä—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–ß–µ—Ä–µ–∑ UI DataLens:**
1. DataLens ‚Üí –°–æ–∑–¥–∞—Ç—å ‚Üí –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å
2. –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª `lct.json`
3. –ù–∞–∂–º–∏—Ç–µ "–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å"

**–ß–µ—Ä–µ–∑ CLI:**
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ YC CLI
curl https://storage.yandexcloud.net/yandexcloud-yc/install.sh | bash

# –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
yc init

# –ò–º–ø–æ—Ä—Ç
yc datalens dashboard import --file Datalens/lct.json
```

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ settings.py

```python
# RSA –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è JWT
private_key = b"""-----BEGIN RSA PRIVATE KEY-----
MIIEogIBAAKCAQEAxIRIjBo/YIVee+R8xUEDGH0MdBsnMxnjbNvHL3C+EqhsHNsi
...
-----END RSA PRIVATE KEY-----"""

# ID –≤—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–≥–æ –¥–∞—à–±–æ—Ä–¥–∞
DATALENS_EMBED_ID = "8e0tatm9jpjit"

# –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞ (—Å–µ–∫—É–Ω–¥—ã)
DATALENS_TOKEN_TTL = 3600  # 1 —á–∞—Å
```

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è RSA –∫–ª—é—á–µ–π

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞
openssl genrsa -out private_key.pem 2048

# –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞
openssl rsa -in private_key.pem -pubout -out public_key.pem

# –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–ª—é—á–∞
cat private_key.pem
```

**–í–∞–∂–Ω–æ:** –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω—É–∂–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö DataLens!

---

## üóÉÔ∏è –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ DataLens

1. **–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è**
   - –¢–∏–ø: MySQL
   - –•–æ—Å—Ç: `31.31.197.64`
   - –ü–æ—Ä—Ç: `3306`
   - –ë–∞–∑–∞: `u3253297_hack`
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: `u3253297_hack`
   - SSL: –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ

2. **–°–æ–∑–¥–∞–Ω–∏–µ –¥–∞—Ç–∞—Å–µ—Ç–∞**
   - –í—ã–±–æ—Ä —Ç–∞–±–ª–∏—Ü: `processed_flights`, `regions`, `region_stats`, etc.
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π –∏ –∏—Ö —Ç–∏–ø–æ–≤

3. **–°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Ä—Ç–æ–≤**
   - –í—ã–±–æ—Ä —Ç–∏–ø–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Å–µ–π –∏ –º–µ—Ä
   - –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤

---

## üìä SQL-–∑–∞–ø—Ä–æ—Å—ã –¥–ª—è DataLens

### –ü—Ä–∏–º–µ—Ä—ã –¥–∞—Ç–∞—Å–µ—Ç–æ–≤

#### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º

```sql
SELECT 
    r.name as region_name,
    rs.date,
    rs.total_flights,
    rs.peak_load,
    rs.flight_density,
    rs.morning_flights,
    rs.afternoon_flights,
    rs.evening_flights,
    rs.night_flights
FROM region_stats rs
JOIN regions r ON rs.region_id = r.id
WHERE rs.prediction = 'download'
```

#### –¢–æ–ø —Ä–µ–≥–∏–æ–Ω–æ–≤ –ø–æ —Ç—Ä–∞—Ñ–∏–∫—É

```sql
SELECT 
    region,
    SUM(total_flights) as total,
    AVG(flight_density) as avg_density,
    MAX(peak_load) as max_peak
FROM region_stats
WHERE prediction = 'download'
GROUP BY region
ORDER BY total DESC
LIMIT 10
```

#### –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–∞–º–æ–ª–µ—Ç—ã

```sql
SELECT 
    a.icao24,
    a.callsign,
    a.latitude,
    a.longitude,
    a.baro_altitude,
    a.velocity,
    r.name as region
FROM aircraft a
LEFT JOIN regions r ON a.region_id = r.id
WHERE a.last_updated >= NOW() - INTERVAL 1 HOUR
```

---

## üé® –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è

### –¶–≤–µ—Ç–æ–≤—ã–µ —Å—Ö–µ–º—ã

**–î–ª—è —Ç–µ–ø–ª–æ–≤–æ–π –∫–∞—Ä—Ç—ã:**
```
–ù–∏–∑–∫–∞—è –ø–ª–æ—Ç–Ω–æ—Å—Ç—å: #00FF00 (–∑–µ–ª–µ–Ω—ã–π)
–°—Ä–µ–¥–Ω—è—è –ø–ª–æ—Ç–Ω–æ—Å—Ç—å: #FFFF00 (–∂–µ–ª—Ç—ã–π)
–í—ã—Å–æ–∫–∞—è –ø–ª–æ—Ç–Ω–æ—Å—Ç—å: #FF8800 (–æ—Ä–∞–Ω–∂–µ–≤—ã–π)
–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è: #FF0000 (–∫—Ä–∞—Å–Ω—ã–π)
```

**–î–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤:**
```
–ê–∫—Ç–∏–≤–Ω—ã–π: #4cc9f0 (–≥–æ–ª—É–±–æ–π)
–û–±—Ä–∞–±–æ—Ç–∫–∞: #ffc300 (–∂–µ–ª—Ç—ã–π)
–û—à–∏–±–∫–∞: #e63946 (–∫—Ä–∞—Å–Ω—ã–π)
–£—Å–ø–µ—Ö: #06d6a0 (–∑–µ–ª–µ–Ω—ã–π)
```

### –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```javascript
// –ß–∏—Å–ª–∞
{
  "format": {
    "type": "number",
    "precision": 2,
    "thousand_separator": " ",
    "decimal_separator": ","
  }
}

// –ü—Ä–æ—Ü–µ–Ω—Ç—ã
{
  "format": {
    "type": "percent",
    "precision": 1
  }
}

// –î–∞—Ç—ã
{
  "format": {
    "type": "date",
    "format": "DD.MM.YYYY"
  }
}
```

---

## üîç –§–∏–ª—å—Ç—Ä—ã –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

### –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã

**–ü–µ—Ä–∏–æ–¥:**
```sql
date BETWEEN :date_from AND :date_to
```

**–†–µ–≥–∏–æ–Ω:**
```sql
region_id = :region_id
```

**–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö:**
```sql
prediction IN (:prediction_types)
```

### –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

```javascript
// –ü–µ—Ä–µ–¥–∞—á–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —á–µ—Ä–µ–∑ URL
const url = `https://datalens.yandex.ru/embed/${embedId}?` + 
  `region_id=77&` +
  `date_from=2024-01-01&` +
  `date_to=2025-12-31&` +
  `_token=${jwt_token}`;
```

---

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

1. **–ò–Ω–¥–µ–∫—Å—ã** –Ω–∞ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø–æ–ª—è—Ö
2. **–ê–≥—Ä–µ–≥–∞—Ü–∏—è** –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î
3. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
4. **–ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü

### –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ DataLens

```
- –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫–µ—à–∞: 5-60 –º–∏–Ω—É—Ç
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- –†—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞
```

---

## üõ†Ô∏è Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –¢–æ–∫–µ–Ω –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–†–µ—à–µ–Ω–∏—è:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Ä–µ–º—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è NTP)
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ DataLens
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –∫–ª—é—á–∞ (PEM, PKCS#1)
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `embedId` ‚Äî –æ–Ω –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å

### –ü—Ä–æ–±–ª–µ–º–∞: –î–∞—à–±–æ—Ä–¥ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏—è:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ iframe –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î

### –ü—Ä–æ–±–ª–µ–º–∞: –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ

**–†–µ—à–µ–Ω–∏—è:**
1. –û—á–∏—Å—Ç–∏—Ç–µ –∫–µ—à DataLens
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞—Ç–∞—Å–µ—Ç–∞
3. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ –ë–î

---

## üìù Best Practices

1. **–†–µ–≥—É–ª—è—Ä–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤** (–∫–∞–∂–¥—ã–µ 50 –º–∏–Ω—É—Ç)
2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** –∑–∞–ø—Ä–æ—Å–æ–≤
3. **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (`lct.json`)
4. **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–∞—à–±–æ—Ä–¥–æ–≤
5. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** –∏–∑–º–µ–Ω–µ–Ω–∏–π
6. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **DataLens**: https://cloud.yandex.ru/docs/datalens/
- **JWT**: https://jwt.io/
- **PyJWT**: https://pyjwt.readthedocs.io/

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

- **JWT Debugger**: https://jwt.io/#debugger
- **DataLens Gallery**: https://datalens.yandex.ru/gallery
- **API Reference**: https://cloud.yandex.ru/docs/datalens/api-ref/

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–ø—Ä–∏–µ—Ç–∞—Ä–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã ¬© 2025 –ö–æ–º–∞–Ω–¥–∞ Finance.

---

**–î–∞—Ç–∞:** 19 –æ–∫—Ç—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** 1.0.0  
**–ú–æ–¥—É–ª—å:** DataLens Integration
